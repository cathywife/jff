#!/usr/bin/env perl
use strict;
use warnings;
use FindBin;
use lib "$FindBin::RealBin/../lib";

use Event::Scheduler;

my $spec = obtain_job_specification();
my $sorted_nodes = topology_sort_nodes($spec->{nodes});

if (exists $ENV{PLUMBER_PORT}) {
    schedule($sorted_nodes, $spec);
} else {
    print JSON->new->pretty->encode($sorted_nodes);
}

###################################################
